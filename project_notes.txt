Задача, создать веб-сервис для автоматической обработки требований-накладных, получаемых от склада,
для создания отчетности о списании запасных частей. Необходима регистрация/авторизация пользователей.
Необходим достаточный уровень безопасности сайта для сохранения целостности и конфиденциальности данных.
На вход будут поступать файлы формата excel, содержащие перечень полученных запасных частей (наименование,
единицы измерения, количество), также важен номер накладной. Сервис должен парсить данные из файла, также
сохранять сам файл, чтобы через конкретное списание иметь возможность увидеть исходную накладную. Работа
будет строиться таким образом, пользователь загружает файл, который проходит валидацию, далее парсер собирает
данные, после чего данные заносятся в общую таблицу. При этом самое интересное, что необходимо будет создать
шаблоны распределения запасных частей, большая часть запасных частей уникальна для отдельного оборудования.
Проще говоря, если мы загрузили например подшипник 205, а у нас с ним есть шаблон, что он устанавливается на 
печь ПКИ, и у этого подшипника нет никаких других шаблонов. То этот подшипник автоматом списывается на это
оборудование. Должно быть как, после добавления файла, если у программы нет разветвления поведения, то 
распределение происходит автоматически, если есть вариативность поведения, то по каждой такой позиции программа
должна вывести некую форму для выбора одного из шаблонов или, если ни один из шаблонов не подходит, позволить
списать на любое оборудование, после отправки формы предложить сохранить новое поведение в шаблон, после чего 
перейти к новому вопросу либо завершить распределение в автоматическом режиме, после чего вывести сводную таблицу
с всплывшим уведомлением поверх, что добавление новых данных успешно завершено или не успешно. Нужно как то резервировать
таблицу в случае неудачной перезаписи, чтоб не потерять данные. Главная старница сама сводная таблица. Со временем она 
станет очень большой, поэтому необходима пагинация, чтобы страница не перегружалась. Пагинация по количеству строк таблицы, 
я думаю. На этом сервисе должна быть предусмотрена возможность получения отчетов и скачивания их. Например расходы
за месяц. Может графики, диаграммы...ну крч надо думать. В этом сервисе все объекты должны быть добавлены в базу для 
структуры. Начнем с крупного, на предприятии есть несколько производств. У каждого производства свое оборудование.
И на каждое оборудование на этом производстве мы можем списывать запасные части и материалы, они тоже должны быть заведены в базу.
Если после парсинга обнаруживается новая позиция. То сервис дает пользователю форму для выбора, куда списать, после отправки 
предлагает сохранить шаблон, но пользователь вправе отказаться. У каждой строки списания, должен быть столбец, обоснование,
тип мы меняем лампу, потому что она сгорела. Обоснования тоже сохраняются в шаблонах. При выборе шаблона у пользователя 
должна быть возможность отредактировать конкретную форму перед отправкой. Тип есть шаблон со стандартными значениями, но вот 
именно в этот раз пользователь хочет изменить обоснование и сохранить в другом виде запись. после нажатия кнопки отправить сервис 
должен предложить пользователю либо перезаписать текущий шаблон, сохранить новый шаблон или отправить без сохранения шаблона. 
Также мы должны уметь формировать отчеты по отдельным производствам или оборудованию. Некоторое оборудование присутствует в нескольких количествах,
так еще и на разных произвоствах, так что id никто не отменял и связь один к одному, для каждой отдельной единцы. ну пока так. 

==============================
MoloFlow – Автоматизация накладных
==============================

1. Цель проекта
---------------
Сервис автоматизирует рутинную задачу списания, использованных материалов и запасных частей, 
которые были получены из склада, на основании требований-накладных, которые получает инженер от 
кладовщиков. Списания необходимы для формирования месячных отчетов и последующей передачи этих 
отчетов в бухгалтерию. 

2. Пользователь
---------------
Пользователями этого сервиса будут инженеры.

3. Основной результат
-------------------
Итогом работы должна быть общая таблица, содержащая строки списаний запасных частей и материалов 
(каждая строка - отдельное списание). Из этой таблицы мы можем получать эксель файлы с использованием 
фильтров (месячный отчет, отчет отдельного производства и т.д.)

4. Модули / Функциональные блоки
--------------------------------
- Аутентификация и безопасность
    • Регистрация/логин
    • Роли и права
    • Защита целостности и конфиденциальности

- Импорт данных
    • Загрузка Excel-файлов
    • Валидация данных
    • Сохранение исходного файла

- Парсинг накладных
    • Извлечение данных: наименование, единицы, количество, номер накладной и т.д.
    • Обработка новых позиций (выбор оборудования / создание шаблона)
    
- Шаблоны распределения
    • Уникальные шаблоны
    • Автоматическое распределение
    • Форма выбора при неоднозначности
    • Редактирование / создание новых шаблонов

- Сводная таблица и визуализация
    • Главная страница – таблица всех списаний
    • Пагинация
    • Уведомления об успешности обработки
    • Скачивание отчетов
    • Графики и диаграммы

- Структура предприятия
    • Производства
    • Оборудование (уникальные единицы)
    • Запасные части
    • Связи «производство → оборудование → запчасть»

- Обоснования
    • Поля обоснования для каждой строки списания
    • Связь с шаблонами
    • Возможность редактировать перед отправкой

5. Сущности базы данных (поля и связи)
--------------------------------------
- User
    • стандартные поля Django
    • роли / права

- Production
    • id
    • название
    • прочие атрибуты (опционально)

- Equipment
    • id (уникальная единица)
    • название
    • производство (ForeignKey)
    • количество единиц

- SparePart
    • id
    • наименование
    • единица измерения
    • количество на складе

- Invoice
    • id
    • номер накладной
    • файл (ссылка на Excel)
    • дата загрузки

- InvoiceLine
    • id
    • invoice (ForeignKey)
    • spare part (ForeignKey)
    • количество
    • статус обработки

- Template
    • id
    • spare part (ForeignKey)
    • оборудование (ForeignKey)
    • обоснование
    • автоматическое / ручное распределение

- Assignment
    • id
    • invoice_line (ForeignKey)
    • template (ForeignKey, optional)
    • оборудование (ForeignKey)
    • обоснование
    • дата списания

- Justification
    • id
    • текст
    • шаблон / Assignment
    • дата создания

6. Поток обработки файла (workflow)
-----------------------------------
1. Пользователь загружает Excel
2. Валидация данных
3. Парсер создаёт InvoiceLine
4. Для каждой строки:
    a) шаблон единственный → автоматическое списание
    b) несколько шаблонов → форма выбора, возможность редактировать / создать новый
5. Обновление сводной таблицы
6. Уведомление о результате
7. Возможность скачивания отчётов и графиков

7. Вопросы/заметки
-----------------
- Как хранить резервные копии таблицы при ошибке записи?
- Стратегия пагинации для больших таблиц
- Возможные поля для фильтров отчётов
- Дополнительно: графики, диаграммы, экспорт
